---
// src/pages/exterior/[slug].astro

import Base from "../../layouts/Base.astro";

import ServiceDetailHero from "../../components/service-detail/ServiceDetailHero.astro";
import ServiceDetailAlternatingRows from "../../components/service-detail/ServiceDetailAlternatingRows.astro";
import ServiceDetailFAQ from "../../components/service-detail/ServiceDetailFAQ.astro";
import ServiceDetailCTA from "../../components/service-detail/ServiceDetailCTA.astro";

import { getServiceTheme, EXTERIOR_SLUGS } from "../../config/serviceThemes";

// ------- Static paths for /exterior/[slug] -------

export const getStaticPaths = () =>
  EXTERIOR_SLUGS.map((slug) => ({ params: { slug } }));

// ------- Page data -------

const { slug = "" } = Astro.params;
const theme = getServiceTheme(slug);

if (!theme) {
  Astro.response.status = 404;
  throw new Error(`Exterior service not found: ${slug}`);
}

const {
  title,
  subtitle,
  color,
  heroImage,
  photos = [],
  process = [],
  benefits = [],
  swatches = [],
  faq = [],
  subFeatures = [],
} = theme;

// CSS variables so hero / CTA can share the same palette
const cssVars = [
  `--surface:${color.surface}`,
  `--surface-grad:${color.surfaceGradient ?? "none"}`,
  `--on-surface:${color.onSurface}`,
  `--primary:${color.primary}`,
  `--primary-dark:${color.primaryDark}`,
  `--on-primary:${color.onPrimary}`,
  `--accent:${color.accent}`,
].join(";");

// Basic SEO description (you can override per theme if you want)
const description = `${title} in Minnesota — ${subtitle} Professional exterior ${title.toLowerCase()} by PaintCraft MN.`;

// Map exterior subFeatures into the structure ServiceDetailAlternatingRows expects
const alternatingItems = subFeatures.map((feat) => ({
  id: feat.id,
  label: feat.label,                 // small kicker pill
  title: feat.modalTitle || feat.label, // main H2 in the row
  img: feat.img,
  modalTitle: feat.modalTitle,
  modalBody: feat.modalBody,
}));
---

<Base
  title={`${title} | Exterior Painting | PaintCraft MN`}
  description={description}
>
  <div style={cssVars}>
    <!-- HERO (shared component from interior) -->
    <ServiceDetailHero
      title={title}
      subtitle={subtitle}
      heroImage={heroImage}
      backHref="/exterior"
      backLabel="Back to Exterior Services"
      ctaLabel="Get a Free Estimate"
    />

    <!-- ALTERNATING ROWS WITH PROCESS MODALS (Behr-style blocks) -->
    {alternatingItems.length > 0 && (
      <ServiceDetailAlternatingRows
        items={alternatingItems}
        fallbackImg={heroImage ?? photos[0] ?? "/placeholder-service.jpg"}
      />
    )}

    <!-- BIG CTA + BBB SEAL (shared CTA component) -->
    <ServiceDetailCTA
      title={`Ready to refresh your ${title.toLowerCase()}?`}
      description="Schedule a quick walk-through and same-day estimate."
      backHref="/exterior"
      backLabel="Back to Exterior Services"
       bbbLink="https://www.bbb.org/us/mn/hopkins/profile/painting-contractors/paintcraft-llc-0704-1000075280/#sealclick"
    />

    <!-- FAQ (SEO-friendly with JSON-LD from component) -->
    {faq.length > 0 && (
      <ServiceDetailFAQ
        title={`${title} – Frequently Asked Questions`}
        items={faq}
      />
    )}
  </div>
</Base>
