---
/**
 * ServiceDetailAlternatingRows.astro
 *
 * Alternating image/text rows with a centered pill that opens a detail modal.
 * Used on interior/exterior sub-service pages (e.g. Walls vs Ceilings, Trim vs Molding).
 */

/**
 * ServiceDetailAlternatingRows.astro
 *
 * Alternating image/text rows with a centered pill that opens a detail modal.
 * Used on interior/exterior sub-service pages (e.g. Walls vs Ceilings, Trim vs Molding).
 */

export type ProcessBlock = {
  id: string;
  label: string;        // small kicker (e.g. "Detailed trim work")
  title: string;        // main heading
  img?: string;         // main image for this block
  modalTitle?: string;  // title inside modal
  modalBody?: string;   // body text inside modal
};

export interface Props {
  items?: ProcessBlock[];
  fallbackImg?: string;
}

const { items = [], fallbackImg = "/placeholder-service.jpg" } =
  Astro.props as Props;
---

{items.length > 0 && (
  <section class="bg-white" id="svc-alt-section">
    <div
      class="mx-auto max-w-6xl px-6 md:px-10 py-16 md:py-20 space-y-20 md:space-y-24"
    >
      {items.map((block, index) => {
        const isEven = index % 2 === 0;
        const imgSrc = block.img ?? fallbackImg;

        return (
          <div class="relative">
            {/* main 2-column layout */}
            <div class="grid md:grid-cols-12 gap-8 items-center">
              {/* Text block */}
              <div
                class={`md:col-span-5 ${
                  isEven ? "md:order-1" : "md:order-2"
                }`}
              >
                {block.label && (
                  <div
                    class="inline-flex items-center rounded-full bg-neutral-100 px-4 py-2 text-xs font-semibold tracking-[0.14em] uppercase text-neutral-500 mb-4"
                  >
                    {block.label}
                  </div>
                )}

                <h2
                  class="text-3xl md:text-4xl font-semibold text-neutral-900 mb-4"
                >
                  {block.title}
                </h2>


                <button
      type="button"
      data-svc-open={block.id}
      class="svc-detail-card group mt-6 flex w-full items-center justify-between gap-4
             rounded-[1.5rem] border border-neutral-200 bg-white px-5 py-4
             shadow-md hover:shadow-xl hover:-translate-y-[2px] transition-all"
    >
      <div class="text-left">
        <p class="text-sm font-semibold text-neutral-900 mb-1">
          Learn about the process
        </p>
        <p class="text-sm text-neutral-600 line-clamp-2">
          Tap to see how we prep, paint, and finish this part of your home.
        </p>
      </div>
      <span
        class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-neutral-300
               bg-neutral-50 text-neutral-800 group-hover:bg-neutral-900 group-hover:text-white
               transition-colors text-lg leading-none"
      >
        +
      </span>
    </button>
              </div>

              {/* Image block */}
              <div
                class={`md:col-span-7 ${
                  isEven ? "md:order-2" : "md:order-1"
                }`}
              >
                <div
                  class="relative rounded-[2rem] overflow-hidden shadow-2xl border border-neutral-200 bg-white
                         aspect-[4/3]"
                >
                  <img
                    src={imgSrc}
                    alt={block.title}
                    class="absolute inset-0 w-full h-full object-cover"
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              </div>
            </div>
            

            {/* Modal for this block */}
            <div
              class="fixed inset-0 z-50 hidden items-center justify-center px-4 md:px-0"
              data-svc-modal={block.id}
            >
              {/* overlay */}
              <div
                class="absolute inset-0 bg-black/40 backdrop-blur-sm"
                data-svc-close
              ></div>

              {/* panel */}
              <div
                class="relative max-w-3xl w-full rounded-[2.5rem] bg-white shadow-2xl border border-neutral-200 overflow-hidden svc-modal-panel"
              >
                <button
                  type="button"
                  data-svc-close
                  class="absolute right-4 top-4 z-10 inline-flex h-9 w-9 items-center justify-center rounded-full bg-white/90 text-neutral-800 shadow-md hover:bg-white"
                  aria-label="Close"
                >
                  âœ•
                </button>

                <div class="grid md:grid-cols-2 gap-0 md:h-[420px]">
  {/* modal image with consistent feel */}
  <div class="relative h-56 md:h-full">
    <img
      src={imgSrc}
      alt={block.title}
      class="absolute inset-0 w-full h-full object-cover"
      loading="lazy"
      decoding="async"
    />
  </div>


                  <div class="p-6 md:p-8 flex flex-col justify-center">
                    <p
                      class="text-xs font-semibold tracking-[0.16em] uppercase text-neutral-500 mb-2"
                    >
                      {block.label || "Our Process"}
                    </p>
                    <h3
                      class="text-2xl md:text-3xl font-semibold text-neutral-900 mb-3"
                    >
                      {block.modalTitle || block.title}
                    </h3>
                    <p
                      class="text-sm md:text-base text-neutral-700 leading-relaxed"
                    >
                      {block.modalBody ||
                        "We handle prep, protection, and precise application so your finish looks great and lasts. Ask about how we tailor products and methods to your specific surface."}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      })}
    </div>

    <script is:inline>
      (() => {
        const scriptEl = document.currentScript;
        if (!scriptEl) return;
        const root = scriptEl.previousElementSibling;
        if (!root) return;

        const openButtons = root.querySelectorAll("[data-svc-open]");
        const modals = root.querySelectorAll("[data-svc-modal]");
        const closeTargets = root.querySelectorAll("[data-svc-close]");

        if (!openButtons.length || !modals.length) return;

        const closeAll = () => {
          modals.forEach((m) => {
            m.classList.add("hidden");
            m.classList.remove("flex");
          });
          document.body.style.overflow = "";
        };

        const open = (id) => {
          modals.forEach((m) => {
            const isTarget = m.getAttribute("data-svc-modal") === id;
            if (isTarget) {
              m.classList.remove("hidden");
              m.classList.add("flex");
            } else {
              m.classList.add("hidden");
              m.classList.remove("flex");
            }
          });
          document.body.style.overflow = "hidden";
        };

        openButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-svc-open");
            if (id) open(id);
          });
        });

        closeTargets.forEach((el) => {
          el.addEventListener("click", closeAll);
        });

        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeAll();
        });
      })();
    </script>

    <style>
      .svc-detail-card {
        transition:
          box-shadow 0.25s ease,
          transform 0.25s ease,
          border-color 0.25s ease;
      }

      .svc-detail-card:hover {
        border-color: rgba(15, 23, 42, 0.12);
      }

      .svc-modal-panel {
        transform: translateY(12px);
        opacity: 0;
        transition: opacity 0.25s ease, transform 0.25s ease;
      }

      [data-svc-modal].flex .svc-modal-panel {
        opacity: 1;
        transform: translateY(0);
      }

      @media (prefers-reduced-motion: reduce) {
        .svc-detail-card,
        .svc-modal-panel {
          transition: none !important;
          transform: none !important;
        }
      }
    </style>
  </section>
)}
