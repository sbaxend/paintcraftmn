---
import WorkCard from "./WorkCard.astro";
import type { WorkItem } from "./WorkCard.astro";

const { items = [] } = Astro.props as { items: WorkItem[] };

const totalCount = items.length;

const typeLabels: Record<WorkItem["type"], string> = {
  interior: "Interior",
  exterior: "Exterior",
  cabinets: "Cabinets",
  commercial: "Commercial",
};

const typeCounts = {
  interior: items.filter((p: WorkItem) => p.type === "interior").length,
  exterior: items.filter((p: WorkItem) => p.type === "exterior").length,
  cabinets: items.filter((p: WorkItem) => p.type === "cabinets").length,
  commercial: items.filter((p: WorkItem) => p.type === "commercial").length,
};

const filters = [
  { id: "all", label: "All projects", count: totalCount },
  ...Object.entries(typeLabels)
    .filter(([type]) => typeCounts[type as keyof typeof typeCounts] > 0)
    .map(([type, label]) => ({
      id: type,
      label,
      count: typeCounts[type as keyof typeof typeCounts],
    })),
];
---

<section
  id="work-gallery-root"
  class="bg-gradient-to-b from-neutral-50 to-white py-14 md:py-20 lg:py-28"
>
<!-- Coming soon -->
<div class="mx-auto max-w-3xl">
  <div class="rounded-3xl border border-neutral-200 bg-white p-6 sm:p-10 shadow-[0_24px_80px_rgba(0,0,0,0.06)]">
    <div class="flex flex-col items-center text-center gap-4">
      <span class="inline-flex items-center gap-2 rounded-full bg-neutral-100 px-4 py-2 text-xs font-semibold tracking-[0.16em] uppercase text-neutral-600">
        Coming Soon
      </span>

      <h3 class="text-2xl sm:text-3xl font-bold tracking-tight text-neutral-900">
        Project photos are on the way.
      </h3>

      <p class="text-neutral-600 text-base sm:text-lg max-w-xl">
        We’re collecting fresh before & after photos from recent interior, exterior, cabinet, and commercial projects.
        Check back soon.
      </p>

      <div class="mt-2 flex flex-col sm:flex-row gap-3">
        <a
          href="/contact"
          class="inline-flex items-center justify-center rounded-full bg-[#C48356] px-6 py-3 font-semibold text-white shadow-md hover:shadow-lg hover:brightness-[0.98] transition"
        >
          Get a Free Estimate
        </a>
        <a
          href="/"
          class="inline-flex items-center justify-center rounded-full border border-neutral-300 bg-white px-6 py-3 font-semibold text-neutral-800 hover:border-[#C48356] hover:text-[#C48356] transition"
        >
          Back to Home
        </a>
      </div>
            <!-- Social follow -->
      <div class="mt-6 flex flex-col items-center gap-3">
        <p class="text-sm font-medium text-neutral-600">
          In the meantime, check out our work on social
        </p>

        <div class="flex gap-3">
          <a
            href="https://instagram.com/paintcraftmn"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 rounded-full border border-neutral-200 bg-white px-4 py-2
                   text-sm font-semibold text-neutral-800 shadow-sm
                   hover:border-[#C48356] hover:text-[#C48356] transition"
            aria-label="PaintCraft on Instagram"
          >
            <!-- Instagram icon -->
            <svg viewBox="0 0 24 24" class="h-4 w-4 fill-current">
              <path d="M7 2C4.24 2 2 4.24 2 7v10c0 2.76 2.24 5 5 5h10c2.76 0 5-2.24 5-5V7c0-2.76-2.24-5-5-5H7zm10 2c1.65 0 3 1.35 3 3v10c0 1.65-1.35 3-3 3H7c-1.65 0-3-1.35-3-3V7c0-1.65 1.35-3 3-3h10zm-5 3a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6zm4.8-.9a1.1 1.1 0 100 2.2 1.1 1.1 0 000-2.2z"/>
            </svg>
            Instagram
          </a>

          <a
            href="https://www.facebook.com/people/PaintCraft/61555203220568/"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 rounded-full border border-neutral-200 bg-white px-4 py-2
                   text-sm font-semibold text-neutral-800 shadow-sm
                   hover:border-[#C48356] hover:text-[#C48356] transition"
            aria-label="PaintCraft on Facebook"
          >
            <!-- Facebook icon -->
            <svg viewBox="0 0 24 24" class="h-4 w-4 fill-current">
              <path d="M22 12a10 10 0 10-11.6 9.9v-7h-2v-2.9h2V9.6c0-2 1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 1.2v1.6h2.2l-.4 2.9h-1.8v7A10 10 0 0022 12z"/>
            </svg>
            Facebook
          </a>
        </div>
      </div>

    </div>
  </div>
</div>

  <!-- <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8"> -->
    <!-- Section Header -->
    <!-- <div class="text-center mb-8 md:mb-12">
      <h2
        class="font-sans font-semibold tracking-tight text-3xl sm:text-4xl md:text-5xl text-neutral-900 mb-3 md:mb-4"
      >
        Transformations
      </h2>
      <p class="text-base sm:text-lg md:text-xl text-neutral-600 max-w-2xl mx-auto">
        Browse interiors, exteriors, cabinets, and commercial work.
      </p>
    </div> -->

    <!-- MOBILE FILTER: Select -->
    <!-- <div class="mb-6 md:hidden">
      <label
        for="work-filter-select"
        class="block text-xs font-semibold tracking-[0.16em] uppercase text-neutral-500 mb-2"
      >
        Filter by project type
      </label>
      <div class="relative">
        <select
          id="work-filter-select"
          class="w-full rounded-full border border-neutral-300 bg-white px-4 py-2.5 pr-9 text-sm font-medium text-neutral-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#C48356]/40 focus:border-[#C48356]"
        >
          {filters.map((f) => (
            <option value={f.id}>
              {f.label} ({f.count})
            </option>
          ))}
        </select>
        <span
          class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-neutral-400"
        >
          <svg
            class="h-4 w-4"
            viewBox="0 0 20 20"
            fill="none"
            stroke="currentColor"
            stroke-width="1.6"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M6 8l4 4 4-4" />
          </svg>
        </span>
      </div>
    </div> -->

    <!-- DESKTOP / TABLET FILTER: Pills -->
    <!-- <div class="hidden md:flex flex-wrap justify-center gap-3 mb-10">
      {filters.map((filter, idx) => (
        <button
          type="button"
          class={`work-filter-btn group relative px-6 py-2.5 rounded-full text-sm md:text-base font-semibold transition-all duration-300 ${
            idx === 0 ? "is-active" : ""
          }`}
          data-filter={filter.id}
        >
          <span class="relative z-10">{filter.label}</span>
          <span class="ml-2 text-xs md:text-sm opacity-70">
            {filter.count}
          </span>
        </button>
      ))}
    </div> -->

    <!-- Gallery Grid -->
    <!-- <div
      id="work-gallery-grid"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 sm:gap-6 lg:gap-8"
    >
      {items.map((project) => (
        <WorkCard
          project={project}
          typeLabel={typeLabels[project.type] ?? project.type}
        />
      ))}
    </div> -->

    <!-- Show more button -->
    <!-- <div class="mt-8 md:mt-10 flex justify-center">
      <button
        id="work-show-more"
        type="button"
        class="hidden px-6 py-3 rounded-full border border-neutral-300 bg-white text-sm font-semibold text-neutral-800 shadow-sm hover:border-[#C48356] hover:text-[#C48356] hover:shadow-md transition-all"
      >
        Show more projects
      </button>
    </div> -->

    <!-- Empty state -->
    <!-- <div id="work-empty-state" class="hidden text-center py-16 md:py-20">
      <div
        class="inline-flex h-14 w-14 md:h-16 md:w-16 items-center justify-center rounded-full bg-neutral-100 mb-4"
      >
        <svg
          class="h-7 w-7 md:h-8 md:w-8 text-neutral-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      </div>
      <p class="text-neutral-600 text-base md:text-lg max-w-sm mx-auto">
        No projects found in this category yet.
      </p>
    </div>
  </div> -->

  <!-- Lightbox Modal -->
  <!-- <div
    id="work-lightbox"
    class="fixed inset-0 z-[70] hidden items-center justify-center bg-black/75 px-3 sm:px-4 md:px-6"
  >
    <button
      type="button"
      id="work-lightbox-backdrop"
      class="absolute inset-0"
      aria-label="Close"
    ></button>

    <div
      class="relative w-full max-w-lg md:max-w-5xl max-h-[90vh] mx-auto rounded-2xl md:rounded-3xl bg-neutral-950 text-white overflow-hidden shadow-[0_28px_90px_rgba(0,0,0,0.75)]"
    > -->
      <!-- Close button -->
      <!-- <button
        type="button"
        id="work-lightbox-close"
        class="absolute top-3 right-3 md:top-4 md:right-4 z-20 inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/60 hover:bg-black/80 transition"
        aria-label="Close"
      >
        <svg
          class="h-4 w-4"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          fill="none"
        >
          <path d="M18 6L6 18" />
          <path d="M6 6l12 12" />
        </svg>
      </button> -->

      <!-- Image -->
      <!-- <div class="relative aspect-[4/5] sm:aspect-[3/4] md:aspect-[16/9] bg-neutral-900">
        <img
          id="work-lightbox-img"
          src=""
          alt=""
          class="h-full w-full object-cover"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent"
        ></div> -->

        <!-- Prev / Next -->
        <!-- <button
          type="button"
          id="work-lightbox-prev"
          class="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/60 hover:bg-black/80 transition"
          aria-label="Previous project"
        >
          <svg
            class="h-5 w-5"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2.4"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>

        <button
          type="button"
          id="work-lightbox-next"
          class="absolute right-3 md:right-4 top-1/2 -translate-y-1/2 inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/60 hover:bg-black/80 transition"
          aria-label="Next project"
        >
          <svg
            class="h-5 w-5"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2.4"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          >
            <path d="M9 18l6-6-6-6" />
          </svg>
        </button>
      </div> -->

      <!-- Details -->
      <!-- <div class="px-5 sm:px-6 md:px-8 py-5 md:py-7 flex flex-col gap-2">
        <p
          id="work-lightbox-type"
          class="text-[11px] sm:text-xs font-semibold tracking-[0.18em] uppercase text-white/60"
        ></p>
        <h3
          id="work-lightbox-title"
          class="text-xl sm:text-2xl md:text-3xl font-bold tracking-tight"
        ></h3>
        <p
          id="work-lightbox-desc"
          class="text-sm md:text-base text-neutral-300"
        ></p>
        <p
          id="work-lightbox-location"
          class="text-xs md:text-sm text-neutral-400 mt-1"
        ></p>
      </div>
    </div>
  </div> -->

  <!-- Mobile filter → trigger same JS as pills -->
  <script is:inline>
    (() => {
      const select = document.getElementById("work-filter-select");
      if (!select) return;

      const buttons = Array.from(
        document.querySelectorAll<HTMLButtonElement>(".work-filter-btn")
      );

      select.addEventListener("change", () => {
  const value = select.value; // plain JS, no TypeScript
  const target = buttons.find(
    (btn) => btn.getAttribute("data-filter") === value
  );
  if (target) {
    target.click(); // uses your existing filter logic
  }
      });
    })();
  </script>
</section>

<style>
  /* hide mobile scrollbar but keep scrollability */
  #work-gallery-root .filters-scroll {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  #work-gallery-root .filters-scroll::-webkit-scrollbar {
    display: none;
  }

  /* pill styling (keeps your JS .is-active toggle working) */
  .work-filter-btn {
    background: #ffffff;
    color: #111827;
    border: 1px solid rgba(148, 163, 184, 0.5);
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
    white-space: nowrap;
  }

  .work-filter-btn:hover {
    border-color: rgba(196, 131, 86, 0.7);
    color: #c48356;
  }

  .work-filter-btn.is-active {
    background: #c48356;
    color: #ffffff;
    border-color: #c48356;
    box-shadow: 0 16px 40px rgba(196, 131, 86, 0.65);
  }
  
</style>

  <script is:inline>
    window.addEventListener("DOMContentLoaded", () => {
      const root = document.getElementById("work-gallery-root");
      if (!root) return;

      const PAGE_SIZE = 6;

      const filterButtons = Array.from(root.querySelectorAll("[data-filter]"));
      const cards = Array.from(root.querySelectorAll(".work-card"));
      const emptyState = document.getElementById("work-empty-state");
      const showMoreBtn = document.getElementById("work-show-more");

      let activeFilter = "all";
      let visibleLimit = PAGE_SIZE;
      let filteredCards = [];
      let visibleCards = [];
      let currentIndex = 0;

      const computeFilteredCards = () => {
        filteredCards = cards.filter((card) => {
          const type = card.getAttribute("data-type");
          return activeFilter === "all" || type === activeFilter;
        });
      };

      const layoutCards = () => {
        computeFilteredCards();

        // hide all first
        cards.forEach((card) => {
          card.classList.add("hidden");
        });

        let visibleCount = 0;

        // show up to visibleLimit
        filteredCards.forEach((card, idx) => {
          const show = idx < visibleLimit;
          if (show) {
            card.classList.remove("hidden");
            visibleCount++;
          }
        });

        // empty state
        if (emptyState) {
          emptyState.classList.toggle("hidden", visibleCount !== 0);
        }

        // update visibleCards for lightbox (only what's currently shown)
        visibleCards = filteredCards.filter((_, idx) => idx < visibleLimit);

        if (currentIndex >= visibleCards.length) currentIndex = 0;

        // handle show more / show less button visibility + label
        if (!showMoreBtn) return;

        const total = filteredCards.length;

        if (total <= PAGE_SIZE) {
          // nothing to paginate
          showMoreBtn.classList.add("hidden");
          return;
        }

        showMoreBtn.classList.remove("hidden");

        if (visibleLimit >= total) {
          // all visible -> offer "show less"
          showMoreBtn.textContent = "Show less";
        } else {
          showMoreBtn.textContent = "Show more projects";
        }
      };

      const applyFilter = (filterId) => {
        activeFilter = filterId;
        visibleLimit = PAGE_SIZE;

        // button visual state
        filterButtons.forEach((btn) => {
          const isActive = btn.getAttribute("data-filter") === filterId;
          btn.classList.toggle("is-active", isActive);
        });

        layoutCards();
      };

      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const filterId = btn.getAttribute("data-filter") || "all";
          applyFilter(filterId);
        });
      });

      if (showMoreBtn) {
        showMoreBtn.addEventListener("click", () => {
          computeFilteredCards();
          const total = filteredCards.length;

          if (visibleLimit >= total) {
            // currently showing all -> collapse back to first page
            visibleLimit = PAGE_SIZE;
            // optional: scroll back up to grid
            document
              .getElementById("work-gallery-grid")
              ?.scrollIntoView({ behavior: "smooth", block: "start" });
          } else {
            // reveal one more page
            visibleLimit += PAGE_SIZE;
          }

          layoutCards();
        });
      }

      // initial state
      applyFilter("all");

      // ------- Lightbox logic --------
      const lightbox = document.getElementById("work-lightbox");
      const backdrop = document.getElementById("work-lightbox-backdrop");
      const closeBtn = document.getElementById("work-lightbox-close");
      const imgEl = document.getElementById("work-lightbox-img");
      const titleEl = document.getElementById("work-lightbox-title");
      const typeEl = document.getElementById("work-lightbox-type");
      const descEl = document.getElementById("work-lightbox-desc");
      const locEl = document.getElementById("work-lightbox-location");
      const prevBtn = document.getElementById("work-lightbox-prev");
      const nextBtn = document.getElementById("work-lightbox-next");

      if (
        !lightbox ||
        !backdrop ||
        !closeBtn ||
        !imgEl ||
        !titleEl ||
        !typeEl ||
        !descEl ||
        !locEl ||
        !prevBtn ||
        !nextBtn
      ) {
        console.warn("[WorkGallery] Missing lightbox elements; lightbox disabled");
        return;
      }

      const typeLabelMap = {
        interior: "Interior",
        exterior: "Exterior",
        cabinets: "Cabinets",
        commercial: "Commercial",
      };

      const renderFromCard = (card) => {
        if (!card) return;
        const dataset = card.dataset;

        imgEl.src = dataset.img || "";
        imgEl.alt = dataset.title || "";

        titleEl.textContent = dataset.title || "";
        typeEl.textContent = typeLabelMap[dataset.type] || dataset.type || "";

        if (dataset.description) {
          descEl.textContent = dataset.description;
          descEl.classList.remove("hidden");
        } else {
          descEl.textContent = "";
          descEl.classList.add("hidden");
        }

        if (dataset.location) {
          locEl.textContent = dataset.location;
          locEl.classList.remove("hidden");
        } else {
          locEl.textContent = "";
          locEl.classList.add("hidden");
        }
      };

      const openLightboxFromCard = (card) => {
        if (!card) return;

        // ensure visibleCards is up to date with current filter + page
        layoutCards();
        currentIndex = visibleCards.indexOf(card);
        if (currentIndex < 0) currentIndex = 0;

        renderFromCard(visibleCards[currentIndex]);

        lightbox.classList.remove("hidden");
        lightbox.classList.add("flex");
        document.body.style.overflow = "hidden";
      };

      const closeLightbox = () => {
        lightbox.classList.add("hidden");
        lightbox.classList.remove("flex");
        document.body.style.overflow = "";
      };

      const goPrev = () => {
        if (!visibleCards.length) return;
        currentIndex =
          (currentIndex - 1 + visibleCards.length) % visibleCards.length;
        renderFromCard(visibleCards[currentIndex]);
      };

      const goNext = () => {
        if (!visibleCards.length) return;
        currentIndex = (currentIndex + 1) % visibleCards.length;
        renderFromCard(visibleCards[currentIndex]);
      };

      cards.forEach((card) => {
        card.addEventListener("click", () => {
          openLightboxFromCard(card);
        });
      });

      backdrop.addEventListener("click", closeLightbox);
      closeBtn.addEventListener("click", closeLightbox);

      prevBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        goPrev();
      });

      nextBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        goNext();
      });

      window.addEventListener("keydown", (e) => {
        if (lightbox.classList.contains("hidden")) return;
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowRight") goNext();
        if (e.key === "ArrowLeft") goPrev();
      });
    });
  </script>

  <style>
    .work-filter-btn {
      background: #ffffff;
      color: #111827;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
    }

    .work-filter-btn.is-active {
      background: #c48356;
      color: #ffffff;
      box-shadow: 0 20px 50px rgba(196, 131, 86, 0.6);
      transform: translateY(-1px);
    }

    .work-card {
      transition: opacity 220ms ease-out, transform 220ms ease-out;
    }

    .work-card.hidden {
      display: none;
      pointer-events: none;
    }
  </style>
</section>
