---
type Stage = {
  id: string;
  title: string;
  desc: string;
  img: string;
};

export interface Props {
  heading?: string;
  stages?: Stage[];
}

const {
  heading = "Our Proven Exterior Process",
  stages = [
    {
      id: "wash",
      title: "Wash & Prep",
      desc:
        "Power-wash, scrape loose paint, sand edges smooth, and spot-prime bare areas for proper adhesion.",
      img: "/exterior_prep.png",
    },
    {
      id: "repair",
      title: "Paint & Perfect",
      desc:
        "Caulk gaps, fill cracks, replace failing wood as needed, and apply the right primer for the substrate.",
      img: "/exterior_prime.png",
    },
    {
      id: "coat",
      title: "Clean & Inspect",
      desc:
        "Premium exterior coatings applied to spec for even coverage, UV resistance, and long-term durability.",
      img: "/exterior_coat.png",
    },
    {
      id: "detail",
      title: "Detail, Clean & Inspect",
      desc:
        "Crisp lines, hardware reinstalled, full site cleanup, and a final walkthrough to ensure you love it.",
      img: "/exterior_details.png",
    },
  ],
} = Astro.props as Props;
---

<section class="relative bg-white py-20 md:py-32 overflow-hidden">
  <div class="relative mx-auto max-w-[1600px] px-4 md:px-10">
    <!-- Top heading -->
    <div class="text-center mb-10">
      <h2 class="text-4xl md:text-5xl font-bold text-neutral-900 tracking-tight">
        {heading}
      </h2>
      <p class="mt-4 text-lg text-neutral-600 max-w-3xl mx-auto">
        Four weather-ready steps to prep, protect, and polish your homeâ€™s exterior.
      </p>
    </div>

    <!-- Bubble -->
    <div
      id="ext-process-bubble"
      class="relative overflow-hidden rounded-[2.5rem] shadow-2xl ring-1 ring-neutral-200/80 bg-black
             h-[420px] md:h-[520px] lg:h-[580px]"
    >
      <!-- Top pills -->
      <div
        class="absolute left-1/2 top-8 md:top-6 lg:top-6 -translate-x-1/2 z-20 
               flex flex-row flex-nowrap gap-2 md:gap-4 
               overflow-x-auto md:overflow-visible 
               px-4 scrollbar-none"
      >
        {stages.map((stage, index) => (
          <button
            type="button"
            data-ext-tab
            data-index={index}
            class={`ext-process-tab px-4 py-2.5 md:px-8 md:py-3.5 
                    rounded-full text-xs md:text-base 
                    font-semibold tracking-tight transition-all duration-300 whitespace-nowrap ${
              index === 0 ? "is-active" : ""
            }`}
          >
            {stage.title}
          </button>
        ))}
      </div>
      <!-- Slides -->
      <div class="relative h-full w-full">
        {stages.map((stage, index) => (
          <div
            data-ext-slide
            class={`ext-slide absolute inset-0 z-0 transition-opacity duration-700 ease-out ${
              index === 0 ? "opacity-100 ext-slide-active" : "opacity-0"
            }`}
          >
            <!-- Background image -->
            <img
              src={stage.img}
              alt={stage.title}
              class="absolute inset-0 h-full w-full object-cover"
              loading={index === 0 ? "eager" : "lazy"}
              decoding="async"
            />
            <!-- Overlay -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/75 via-black/45 to-black/10"></div>

            <!-- Text content -->
            <div class="relative z-10 h-full w-full flex items-end justify-center">
              <div class="px-6 md:px-12 pb-12 md:pb-16 max-w-3xl text-center">
                <h3 class="text-white text-3xl md:text-5xl font-black tracking-tight mb-4">
                  {stage.title}
                </h3>
                <p class="text-white/90 text-base md:text-lg leading-relaxed">
                  {stage.desc}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Bottom CTA -->
    <div class="mt-12 text-center">
      <a
        href="/contact"
        class="inline-flex items-center justify-center rounded-full bg-[#C48356] px-8 py-4 text-lg font-semibold text-white shadow-lg hover:bg-[#B47347] hover:shadow-xl hover:scale-105 transition-all"
      >
        Get Your Free Exterior Estimate
        <svg class="ml-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          />
        </svg>
      </a>
    </div>
  </div>
</section>

<script is:inline>
  (() => {
    const bubble = document.getElementById("ext-process-bubble");
    if (!bubble) return;

    const tabs = Array.from(bubble.querySelectorAll("[data-ext-tab]"));
    const slides = Array.from(bubble.querySelectorAll("[data-ext-slide]"));

    if (!tabs.length || !slides.length) return;

    let current = 0;

    const setActive = (index) => {
      current = index;

      slides.forEach((slide, i) => {
        const active = i === index;
        slide.classList.toggle("ext-slide-active", active);
        slide.classList.toggle("opacity-100", active);
        slide.classList.toggle("opacity-0", !active);
      });

      tabs.forEach((tab, i) => {
        const active = i === index;
        tab.classList.toggle("is-active", active);
        tab.setAttribute("aria-pressed", String(active));
      });
    };

    tabs.forEach((tab, index) => {
      tab.addEventListener("click", () => setActive(index));
    });

    // init
    setActive(0);
  })();
</script>

<style>
  /* Slide base state */
  .ext-slide {
    opacity: 0;
  }
  .ext-slide-active {
    opacity: 1;
  }

  /* pill styling */
  .ext-process-tab {
    background: rgba(255, 255, 255, 0.16);
    color: rgba(255, 255, 255, 0.88);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
    backdrop-filter: blur(18px);
    white-space: nowrap;
  }

  .ext-process-tab:hover {
    background: rgba(255, 255, 255, 0.22);
  }

  .ext-process-tab.is-active {
    background: #ffffff;
    color: #111827;
    transform: translateY(-2px);
    box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
  }

  @media (prefers-reduced-motion: reduce) {
    .ext-process-tab,
    .ext-slide {
      transition: none !important;
    }
  }
</style>
