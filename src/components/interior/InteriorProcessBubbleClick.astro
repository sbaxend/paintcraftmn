---
type Stage = {
  id: string;
  title: string;
  desc: string;
  img: string;
};

export interface Props {
  heading?: string;
  stages?: Stage[];
}

const {
  heading = "Our Proven Process",
  stages = [],
} = Astro.props as Props;
---

<section class="relative bg-neutral-50 pt-10 md:pt-14 pb-20 md:pb-28">

  <div class="relative mx-auto max-w-[1600px] px-4 md:px-10">
    <!-- Top heading -->
    <div class="text-center mb-10">
      <h2 class="font-sans font-semibold text-4xl md:text-5xl font-bold text-neutral-900 tracking-tight">
        {heading}
      </h2>
      <p class="mt-4 text-lg text-neutral-600 max-w-3xl mx-auto">
        Three simple steps to transform your space with professional results.
      </p>
    </div>

    <!-- Bubble -->
    <div
      id="process-bubble"
      class="relative overflow-hidden rounded-[2.5rem] shadow-2xl ring-1 ring-neutral-200/80 bg-black
             h-[420px] md:h-[520px] lg:h-[580px]"
    >
      <!-- Top pills (single row) -->
     <div
  class="absolute left-1/2 top-8 md:top-6 lg:top-6 -translate-x-1/2 z-20 
         flex flex-row flex-nowrap gap-2 md:gap-4 
         overflow-x-auto md:overflow-visible 
         px-4 scrollbar-none"
>
  {stages.map((stage, index) => (
    <button
      type="button"
      data-ipb-tab
      data-index={index}
      class={`process-tab px-4 py-2.5 md:px-8 md:py-3.5 
              rounded-full text-xs md:text-base 
              font-semibold tracking-tight transition-all duration-300 whitespace-nowrap ${
                index === 0 ? "is-active" : ""
              }`}
    >
      {stage.title}
    </button>
  ))}
</div>

      <!-- Slides -->
      <div class="relative h-full w-full">
        {stages.map((stage, index) => (
          <div
            data-ipb-slide
            class={`ipb-slide absolute inset-0 z-0 transition-opacity duration-700 ease-out ${
              index === 0 ? "opacity-100 ipb-slide-active" : "opacity-0"
            }`}
          >
            <!-- Background image -->
            <img
              src={stage.img}
              alt={stage.title}
              class="absolute inset-0 h-full w-full object-cover"
              loading={index === 0 ? "eager" : "lazy"}
              decoding="async"
            />
            <!-- Overlay -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/75 via-black/45 to-black/10"></div>

            <!-- Text content -->
            <div class="relative z-10 h-full w-full flex items-end justify-center">
              <div class="px-6 md:px-12 pb-12 md:pb-16 max-w-3xl text-center">
                <h3 class="text-white text-3xl md:text-5xl font-sans font-semibold font-black tracking-tight mb-4">
                  {stage.title}
                </h3>
                <p class="text-white/90 text-base md:text-lg leading-relaxed">
                  {stage.desc}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Bottom CTA -->
    <div class="mt-12 text-center">
      <a
        href="/contact"
        class="inline-flex items-center justify-center rounded-full bg-[#C48356] px-8 py-4 text-lg font-semibold text-white shadow-lg hover:bg-[#B47347] hover:shadow-xl hover:scale-105 transition-all"
      >
        Start Your Project
        <svg class="ml-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          />
        </svg>
      </a>
    </div>
  </div>
</section>

<script is:inline>
  (() => {
    const bubble = document.getElementById("process-bubble");
    if (!bubble) return;

    const tabs = Array.from(bubble.querySelectorAll("[data-ipb-tab]"));
    const slides = Array.from(bubble.querySelectorAll("[data-ipb-slide]"));

    if (!tabs.length || !slides.length) return;

    let current = 0;

    const setActive = (index) => {
      current = index;

      slides.forEach((slide, i) => {
        const active = i === index;
        slide.classList.toggle("ipb-slide-active", active);
        slide.classList.toggle("opacity-100", active);
        slide.classList.toggle("opacity-0", !active);
      });

      tabs.forEach((tab, i) => {
        const active = i === index;
        tab.classList.toggle("is-active", active);
        tab.setAttribute("aria-pressed", String(active));
      });
    };

    tabs.forEach((tab, index) => {
      tab.addEventListener("click", () => setActive(index));
    });

    // init
    setActive(0);
  })();
</script>

<style>
  /* Slide base state */
  .ipb-slide {
    opacity: 0;
  }
  .ipb-slide-active {
    opacity: 1;
  }

  /* pill styling */
  .process-tab {
    background: rgba(255, 255, 255, 0.16);
    color: rgba(255, 255, 255, 0.88);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
    backdrop-filter: blur(18px);
    white-space: nowrap; /* keep text on one line */
  }

  .process-tab:hover {
    background: rgba(255, 255, 255, 0.22);
  }

  .process-tab.is-active {
    background: #ffffff;
    color: #111827;
    transform: translateY(-2px);
    box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
  }

  /* reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .process-tab,
    .ipb-slide {
      transition: none !important;
    }
  }
</style>
